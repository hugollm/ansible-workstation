---
- name: Python
  tags: python
  block:

    - name: Make sure curl is installed
      apt:
        name: curl
        state: present

    - name: Install pipenv
      become: yes
      shell: curl https://raw.githubusercontent.com/kennethreitz/pipenv/master/get-pipenv.py | python

    - name: Check if pyenv is installed for the current user
      stat:
        path: ~/.pyenv
      register: pyenv

    - name: Download pyenv installer
      get_url:
        url: https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer
        dest: /tmp/pyenv-installer.sh
      when: not pyenv.stat.exists

    - name: Install pyenv
      shell: bash /tmp/pyenv-installer.sh
      when: not pyenv.stat.exists

    - name: Add pyenv lines to bashrc
      blockinfile:
        path: ~/.bashrc
        block: |
          # pyenv
          export PATH="~/.pyenv/bin:$PATH"
          eval "$(pyenv init -)"
          eval "$(pyenv virtualenv-init -)"

    - name: Update pyenv
      shell: ~/.pyenv/bin/pyenv update
